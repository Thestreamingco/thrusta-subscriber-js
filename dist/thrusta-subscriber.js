var ThrustaSubscriber=function(t){var e={};function s(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,s),r.l=!0,r.exports}return s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)s.d(i,r,function(e){return t[e]}.bind(null,r));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=1)}([function(t,e,s){"use strict";(function(t){var s={};function i(t){return t?function(t){for(var e in i.prototype)t[e]=i.prototype[e];return t}(t):void 0}!function(){var e=["responseType","withCredentials","timeout","onprogress"];function i(t,e,s){t[e]=t[e]||s}s.ajax=function(s,r){var n=s.headers||{},o=s.body,a=s.method||(o?"POST":"GET"),h=!1,c=function(e){if(e&&t.XDomainRequest&&!/MSIE 1/.test(navigator.userAgent))return new XDomainRequest;if(t.XMLHttpRequest)return new XMLHttpRequest}(s.cors);function l(t,e){return function(){h||(r(void 0===c.status?t:c.status,0===c.status?"Error":c.response||c.responseText||e,c),h=!0)}}c.open(a,s.url,!0);var u=c.onload=l(200);c.onreadystatechange=function(){4===c.readyState&&u()},c.onerror=l(null,"Error"),c.ontimeout=l(null,"Timeout"),c.onabort=l(null,"Abort"),o&&(i(n,"X-Requested-With","XMLHttpRequest"),t.FormData&&o instanceof t.FormData||i(n,"Content-Type","application/x-www-form-urlencoded"));for(var d=0,p=e.length;d<p;d++)void 0!==s[m=e[d]]&&(c[m]=s[m]);for(var m in n)c.setRequestHeader(m,n[m]);return c.send(o),c}}(),i.prototype.on=i.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this},i.prototype.once=function(t,e){function s(){this.off(t,s),e.apply(this,arguments)}return s.fn=e,this.on(t,s),this},i.prototype.off=i.prototype.removeListener=i.prototype.removeAllListeners=i.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var s=this._callbacks["$"+t];if(!s)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var i,r=0;r<s.length;r++)if((i=s[r])===e||i.fn===e){s.splice(r,1);break}return this},i.prototype.emit=function(t){this._callbacks=this._callbacks||{};var e=[].slice.call(arguments,1),s=this._callbacks["$"+t];if(s)for(var i=0,r=(s=s.slice(0)).length;r>i;++i)s[i].apply(this,e);return this},i.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},i.prototype.hasListeners=function(t){return!!this.listeners(t).length};var r=Function.prototype.bind?function(t,e){return t.bind(e)}:function(t,e){return function(){t.apply(e,arguments)}},n={};function o(e,s,i){if("undefined"!=typeof window&&this===window)throw"use 'new ThrustaSubscriber(...)' to initialize";if(this.url=`https://${e}.sub.thrusta.io/${s}`,"string"==typeof(i=i||{})&&(i={subscriber:i}),i.transport&&!i.subscriber&&(i.subscriber=i.transport),"string"==typeof i.subscriber&&(i.subscriber=[i.subscriber]),this.desiredTransport=i.subscriber,i.shared){if(!("localStorage"in t))throw"localStorage unavailable for use in shared ThrustaSubscriber";var n="ThrustaSubscriber:"+this.url+":shared:",o=function(t){return n+t},a=t.localStorage;this.shared={id:""+Math.random()+Math.random(),key:o,get:function(t){return a.getItem(o(t))},set:function(t,e){return a.setItem(o(t),e)},setWithId:r(function(t,e){return this.shared.set(t,"##"+this.shared.id+":"+e)},this),getWithId:r(function(t){return this.shared.stripIdFromVal(this.shared.get(t))},this),stripIdFromVal:function(t){if(!t)return t;var e=t.indexOf(":");return t[0]==t[1]&&"#"==t[0]&&e?t.substring(e+1,t.length):t},remove:function(t){return a.removeItem(o(t))},matchEventKey:r(function(t,e){return(!t.storageArea||t.storageArea==a)&&t.key==o(e)},this),matchEventKeyWithId:r(function(t,e){if(this.shared.matchEventKey(t,e)){var s=t.newValue,i=s.indexOf(":");return s[0]!=s[1]||"#"!=s[0]||!i||s.substring(2,i)!=this.shared.id}return!1},this),setRole:r(function(t){if("master"==t&&"master"!=this.shared.role){var e=(new Date).getTime()/1e3;this.shared.setWithId("master:created",e),this.shared.setWithId("master:lastSeen",e)}return"slave"!=t||this.lastMessageId||(this.lastMessageId=this.shared.get("msg:id")),this.shared.role=t,this},this),demoteToSlave:r(function(){if("master"!=this.shared.role)throw"can't demote non-master to slave";this.running?(this.stop(),this.shared.setRole("slave"),this.initializeTransport(),this.start()):this.initializeTransport()},this),maybePromoteToMaster:r(function(){if(!this.running&&!this.starting)return this;if(!this.shared.maybePromotingToMaster){var e;this.shared.maybePromotingToMaster=!0;var s,i=0,n=Math.random(),o=n,a=r(function(t){var s=parseFloat(this.shared.getWithId("lotteryTime")),i=parseFloat(this.shared.getWithId("lottery"));(!s||s>(new Date).getTime()-4e3)&&i&&(!o||i>o)&&(o=i),t||e()},this);a(!0),this.shared.setWithId("lottery",n),this.shared.setWithId("lotteryTime",(new Date).getTime()/1e3);var h=r(function(t){if(this.shared.matchEventKeyWithId(t,"lottery")&&t.newValue){i+=1;var e=parseFloat(this.shared.stripIdFromVal(t.newValue)),s=parseFloat(this.shared.stripIdFromVal(t.oldValue));s>e&&this.shared.setWithId("lottery",s),(!o||e>=o)&&(o=e)}},this);t.addEventListener("storage",h);var c=r(function(){this.shared.maybePromotingToMaster=!1,t.removeEventListener("storage",h),s&&clearInterval(s),this.shared&&"master"==this.shared.role&&(this.shared.remove("lottery"),this.shared.remove("lotteryTime")),this.running?(this.stop(),this.initializeTransport(),this.start()):(this.initializeTransport(),this.starting&&this.start())},this);e=r(function(){n<o?(this.shared.setRole("slave"),c()):n>=o&&(0==i?(this.shared.setRole("master"),c()):i=0)},this),s=t.setInterval(a,2e3)}},this),masterCheckInterval:1e4}}var h;if(this.lastMessageId=i.id||i.msgId,this.reconnect=void 0===i.reconnect||i.reconnect,this.reconnectTimeout=i.reconnectTimeout||1e3,i.reconnect){var c,l="ThrustaSubscriber:"+this.url+":lastMessageId";if("persist"==i.reconnect){if(!(c="localStorage"in t&&t.localStorage))throw"can't use reconnect: 'persist' option: localStorage not available"}else{if("session"!=i.reconnect)throw"invalid 'reconnect' option value "+i.reconnect;if(!(c="sessionStorage"in t&&t.sessionStorage))throw"can't use reconnect: 'session' option: sessionStorage not available"}h=r(function(t){this.shared&&"slave"==this.shared.role||c.setItem(l,t)},this),this.lastMessageId=c.getItem(l)}else h=function(){};var u,d,p=r(function(){this.running&&this.stop(),this.shared&&"master"==this.shared.role&&this.shared.setWithId("status","disconnected")},this);t.addEventListener("beforeunload",p,!1),t.addEventListener("DOMContentLoaded",function(){t.removeEventListener("beforeunload",p,!1),t.addEventListener("unload",p,!1)},!1),u=this.shared?r(function(t,e){"master"==this.shared.role&&("message"==t?(this.shared.set("msg:id",e[1]&&e[1].id||""),this.shared.set("msg:content-type",e[1]&&e[1]["content-type"]||""),this.shared.set("msg",e[0])):"error"==t||("connecting"==t?this.shared.setWithId("status","connecting"):"connect"==t?this.shared.setWithId("status","connected"):"reconnect"==t?this.shared.setWithId("status","reconnecting"):"disconnect"==t&&this.shared.setWithId("status","disconnected")))},this):function(){};var m=r(function(){d||!this.running||!this.reconnect||this.transport.reconnecting||this.transport.doNotReconnect?u("disconnect"):(u("reconnect"),d=t.setTimeout(r(function(){d=null,this.stop(),this.start()},this),this.reconnectTimeout))},this);this.on("message",function(t,e){this.lastMessageId=e.id,e.id&&h(e.id),u("message",[t,e])}),this.on("error",function(t,e){m(t,e),u("error",[t,e])}),this.on("connect",function(){this.connected=!0,u("connect")}),this.on("__disconnect",function(t,e){this.connected=!1,this.emit("disconnect",t,e),m(t,e)})}i(o.prototype);var a,h=function(){var t={url:null,msgid:null,headers:{}};for(var e in o.prototype.SubscriberClass)"__slave"!=e&&(t[e]={});return t};function c(t,e){if(e){var s=t.match(/(\?.*)$/);t+=(s?"&":"?")+"last_event_id="+encodeURIComponent(e)}return t}function l(t){var e,s=0;if(t)for(e in t)t.hasOwnProperty(e)&&s++;return s}o.prototype.initializeTransport=function(t){if(t&&(this.desiredTransport=t),this.shared&&"slave"==this.shared.role)this.transport=new this.SubscriberClass.__slave(r(this.emit,this));else{var e,s=r(function(t){if(!this.SubscriberClass[t])throw"unknown subscriber type "+t;try{return this.transport=new this.SubscriberClass[t](r(this.emit,this)),this.transport}catch(t){}},this);if(this.desiredTransport)for(e=0;e<this.desiredTransport.length&&!s(this.desiredTransport[e]);e++);else for(e in this.SubscriberClass)if(this.SubscriberClass.hasOwnProperty(e)&&"_"!=e[0]&&s(e))break}if(!this.transport)throw"can't use any transport type"},o.prototype.start=function(){if(this.running)throw"Can't start ThrustaSubscriber, it's already started.";if(this.starting=!0,this.shared){if(n[this.url]&&n[this.url]!=this)throw"Only 1 shared subscriber allowed per url per window/tab.";if(n[this.url]=this,!this.shared.role){var e=this.shared.getWithId("status");a=r(function(t){this.shared.matchEventKeyWithId(t,"status")?"disconnected"==this.shared.stripIdFromVal(t.newValue)&&("slave"==this.shared.role?this.shared.maybePromoteToMaster():this.shared.role):"master"==this.shared.role&&this.shared.matchEventKeyWithId(t,"master:created")&&t.newValue&&this.shared.demoteToSlave()},this),t.addEventListener("storage",a),"disconnected"==e?this.shared.maybePromoteToMaster():(this.shared.setRole(e?"slave":"master"),this.initializeTransport())}"master"==this.shared.role?(this.shared.setWithId("status","connecting"),this.transport.listen(this.url,this.lastMessageId),this.running=!0,this.starting=!1,this.shared.masterIntervalCheckID=t.setInterval(r(function(){this.shared.setWithId("master:lastSeen",(new Date).getTime()/1e3)},this),.8*this.shared.masterCheckInterval)):"slave"==this.shared.role&&(this.transport.listen(this.url,this.shared),this.running=!0,this.starting=!1,this.shared.masterIntervalCheckID=t.setInterval(r(function(){var t=parseFloat(this.shared.getWithId("master:lastSeen"));(!t||t<(new Date).getTime()/1e3-this.shared.masterCheckInterval/1e3)&&this.shared.maybePromoteToMaster()},this),this.shared.masterCheckInterval))}else this.transport||this.initializeTransport(),this.transport.listen(this.url,this.lastMessageId),this.running=!0,this.starting=!1;return this},o.prototype.stop=function(){if(!this.running)throw"Can't stop ThrustaSubscriber, it's not running.";return this.running=!1,a&&t.removeEventListener("storage",a),this.transport.cancel(),this.shared&&(delete n[this.url],this.shared.masterIntervalCheckID&&(clearInterval(this.shared.masterIntervalCheckID),this.shared.masterIntervalCheckID=null)),this},o.prototype.SubscriberClass={websocket:function(){function t(t){WebSocket,this.listener=null,this.emit=t,this.name="websocket",this.opt=h(),this.opt.headers["Sec-WebSocket-Protocol"]="ws+meta.nchan"}return t.prototype.setup=function(){if(this.emit("transportSetup",this.opt,this.name),1!=l(this.opt.headers)&&"Sec-WebSocket-Protocol"in this.opt.headers)throw"WebSocket only supports one header; Sec-WebSocket-Protocol"},t.prototype.websocketizeURL=function(t){var e,s=t.match(/^((\w+:)?\/\/([^\/]+))?(\/)?(.*)/),i=s[2],r=s[3],n=s[4],o=s[5];return"object"==typeof window?e=window.location:"object"==typeof document&&(e=document.location),!i&&e&&(i=e.protocol),"https:"==i?i="wss:":"http:"==i?i="ws:":"ws:"!=i&&(i="wss:"),!r&&e&&(r=e.host),i+"//"+r+(o=n?"/"+o:e?e.pathname.match(/(.*\/)[^\/]*/)[1]+o:"/"+o)},t.prototype.listen=function(t,e){if(this.listener)throw"websocket already listening";this.opt.url=t,this.opt.msgid=e,this.setup(),t=c(t=this.websocketizeURL(this.opt.url),this.opt.msgid),this.listener=new WebSocket(t,this.opt.headers["Sec-WebSocket-Protocol"]);var s=this.listener;this.emit("transportNativeCreated",s,this.name),s.onmessage=r(function(t){if(t.data instanceof Blob){var e=t.data.slice(0,255),s=new FileReader;s.addEventListener("loadend",r(function(){var e=s.result.match(/^id: (.*)\n(content-type: (.*)\n)?\n/m);this.emit("message",t.data.slice(e[0].length),{id:e[1],"content-type":e[3]})},this)),s.readAsText(e)}else{var i=t.data.match(/^id: (.*)\n(content-type: (.*)\n)?\n/m);this.emit("message",t.data.substr(i[0].length),{id:i[1],"content-type":i[3]})}},this),s.onopen=r(function(t){this.emit("connect",t)},this),s.onerror=r(function(t){this.emit("error",t,s),this.listener=null},this),s.onclose=r(function(t){this.emit("__disconnect",t),this.listener=null},this)},t.prototype.cancel=function(){this.listener&&(this.emit("transportNativeBeforeDestroy",this.listener,this.name),this.listener.close(),this.listener=null)},t}(),eventsource:function(){function t(t){EventSource,this.listener=null,this.emit=t,this.name="eventsource",this.opt=h(),this.opt.eventsource.withCredentials=!1}return t.prototype.setup=function(){if(this.emit("transportSetup",this.opt,this.name),0!=l(this.opt.headers))throw"EventSource does not support headers"},t.prototype.listen=function(t,e){if(this.listener)throw"there's a ES listener running already";this.opt.url=t,this.opt.msgid=e,this.setup(),t=c(this.opt.url,this.opt.msgid),this.listener=new EventSource(t,this.opt.eventsource);var s=this.listener;this.emit("transportNativeCreated",s,this.name),s.onmessage=r(function(t){this.emit("message",t.data,{id:t.lastEventId})},this),s.onopen=r(function(t){this.reconnecting=!1,this.emit("connect",t)},this),s.onerror=r(function(t){this.listener.readyState!=EventSource.CONNECTING||this.reconnecting?this.emit("__disconnect",t):this.reconnecting||(this.reconnecting=!0,this.emit("__disconnect",t))},this)},t.prototype.cancel=function(){this.listener&&(this.emit("transportNativeBeforeDestroy",this.listener,this.name),this.listener.close(),this.listener=null)},t}(),longpoll:function(){function e(t){this.req=null,this.reqStartTime=null,this.pollingRequest=null,this.nextRequestTimer=null,this.longPollStartTime=null,this.maxLongPollTime=3e5,this.emit=t,this.name="longpoll",this.opt=h(),this.opt.longpoll.pollDelay=0}return e.prototype.setup=function(){this.emit("transportSetup",this.opt,this.name)},e.prototype.listen=function(e,i){if(this.req)throw"already listening";this.opt.url=e,this.opt.msgid=i,i&&(this.opt.headers.Etag=i),this.setup();var n,o=r(function(t,e){t&&(this.opt.headers[e]=t)},this);return this.pollingRequest=r(function(){this.req&&this.emit("transportNativeBeforeDestroy",this.req,this.name),this.nextRequestTimer=null,this.reqStartTime=(new Date).getTime(),this.req=s.ajax({url:this.opt.url,headers:this.opt.headers},n),this.emit("transportNativeCreated",this.req,this.name)},this),n=r(function(e,s,i){if(o(i.getResponseHeader("Last-Modified"),"If-Modified-Since"),o(i.getResponseHeader("Etag"),"If-None-Match"),e>=200&&e<=210){var r=i.getResponseHeader("Content-Type");this.parseMultipartMixedMessage(r,s,i)||this.emit("message",s||"",{"content-type":r,id:this.msgIdFromResponseHeaders(i)}),this.req&&(0==this.opt.longpoll.pollDelay?this.pollingRequest():this.nextRequestTimer=t.setTimeout(this.pollingRequest,this.opt.longpoll.pollDelay))}else 0==e&&"Error"==s&&4==i.readyState||null===e&&"Abort"!=s?(this.emit("__disconnect",e||0,s),this.cancel()):null!==e?(this.emit("error",e,s),this.cancel()):(this.cancel(),this.emit("__disconnect"))},this),this.pollingRequest(),this.emit("connect"),this},e.prototype.parseMultipartMixedMessage=function(t,e,s){var i=t&&t.match(/^multipart\/mixed;\s+boundary=(.*)$/);if(!i)return!1;var r=i[1],n=e.split("--"+r);if(""!=n[0]||!n[n.length-1].match(/--\r?\n/))throw"weird multipart/mixed split";for(var o in n=n.slice(1,-1)){var a=(i=n[o].match(/^(.*)\r?\n\r?\n([\s\S]*)\r?\n$/m))[1].split("\n"),h={};for(var c in a){var l=a[c].match(/^([^:]+):\s+(.*)/);l&&"Content-Type"==l[1]&&(h["content-type"]=l[2])}o==n.length-1&&(h.id=this.msgIdFromResponseHeaders(s)),this.emit("message",i[2],h)}return!0},e.prototype.msgIdFromResponseHeaders=function(t){var e,s;return e=t.getResponseHeader("Last-Modified"),s=t.getResponseHeader("Etag"),e?Date.parse(e)/1e3+":"+(s||"0"):s||null},e.prototype.cancel=function(){return this.req&&(this.emit("transportNativeBeforeDestroy",this.req,this.name),this.req.abort(),this.req=null),this.cancelPendingPollRequest(),this},e.prototype.cancelPendingPollRequest=function(){this.nextRequestTimer&&(t.clearTimeout(this.nextRequestTimer),this.nextRequestTimer=null)},e}(),__slave:function(){function e(t){this.emit=t,this.doNotReconnect=!0,this.shared=null,this.name="__slave",this.opt=h()}return e.prototype.setup=function(){if(this.emit("transportSetup",this.opt,this.name),0!=l(this.opt.headers))throw"__slave does not support headers"},e.prototype.listen=function(e,s){this.shared=s,this.opt.url=e,this.setup(),this.statusChangeChecker=r(function(t){if(this.shared.matchEventKey(t,"msg")){var e=this.shared.get("msg:id"),s=this.shared.get("msg:content-type"),i=this.shared.get("msg");this.emit("message",i,{id:""==e?void 0:e,"content-type":""==s?void 0:s})}},this),t.addEventListener("storage",this.statusChangeChecker)},e.prototype.cancel=function(){t.removeEventListener("storage",this.statusChangeChecker)},e}()},e.a=o}).call(this,s(2))},function(t,e,s){"use strict";s.r(e);var i=s(0);e.default=i.a},function(t,e){var s;s=function(){return this}();try{s=s||new Function("return this")()}catch(t){"object"==typeof window&&(s=window)}t.exports=s}]).default;